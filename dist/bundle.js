(()=>{"use strict";function e(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}class t{constructor(e){this.slides=e,this.currentSlideIndex=0,this._elem=this.#e(),this.#t()}get elem(){return this._elem}#e(){const t=e('\n      <div class="carousel">\n        <div class="carousel__arrow carousel__arrow_right">\n          <img src="/assets/images/icons/angle-icon.svg" alt="icon">\n        </div>\n        <div class="carousel__arrow carousel__arrow_left" style="display: none">\n          <img src="/assets/images/icons/angle-left-icon.svg" alt="icon">\n        </div>\n        <div class="carousel__inner"></div>\n      </div>\n    '),s=t.querySelector(".carousel__inner");return this.slides.forEach((t=>{s.append(e(`\n        <div class="carousel__slide" data-id="${t.id}">\n          <img src="/assets/images/carousel/${t.image}" class="carousel__img" alt="${t.name}">\n          <div class="carousel__caption">\n            <span class="carousel__price">€${t.price.toFixed(2)}</span>\n            <div class="carousel__title">${t.name}</div>\n            <button type="button" class="carousel__button">\n              <img src="/assets/images/icons/plus-icon.svg" alt="icon">\n            </button>\n          </div>\n        </div>\n      `))})),t}#t(){const e=this._elem.querySelector(".carousel__inner");setTimeout((()=>{this.slideWidth=e.offsetWidth,this.#s()}),0),this._elem.addEventListener("click",(e=>{if(e.target.closest(".carousel__button")){const t=e.target.closest(".carousel__slide");return void this._elem.dispatchEvent(new CustomEvent("product-add",{detail:t.dataset.id,bubbles:!0}))}const t=e.target.closest(".carousel__arrow");t&&(t.classList.contains("carousel__arrow_right")?this.currentSlideIndex<this.slides.length-1&&this.currentSlideIndex++:t.classList.contains("carousel__arrow_left")&&this.currentSlideIndex>0&&this.currentSlideIndex--,this.#s())}))}#s(){const e=this._elem.querySelector(".carousel__inner"),t=this._elem.querySelector(".carousel__arrow_right"),s=this._elem.querySelector(".carousel__arrow_left");e.style.transform=`translateX(-${this.currentSlideIndex*this._elem.offsetWidth}px)`,s.style.display=0===this.currentSlideIndex?"none":"",t.style.display=this.currentSlideIndex===this.slides.length-1?"none":""}}const s=[{name:"Penang shrimp",price:16,image:"penang_shrimp.png",id:"penang-shrimp"},{name:"Chicken cashew",price:14,image:"chicken_cashew.png",id:"chicken-cashew"},{name:"Red curry veggies",price:12.5,image:"red_curry_vega.png",id:"red-curry-veggies"},{name:"Chicken springrolls",price:6.5,image:"chicken_loempias.png",id:"chicken-springrolls"}];class n{constructor(e){this.categories=e,this._elem=this.#e(),this.#n()}get elem(){return this._elem}#e(){const t=e('\n      <div class="ribbon">\n        <button class="ribbon__arrow ribbon__arrow_left ribbon__arrow_visible">\n          <img src="/assets/images/icons/angle-icon.svg" alt="icon">\n        </button>\n        <nav class="ribbon__inner"></nav>\n        <button class="ribbon__arrow ribbon__arrow_right ribbon__arrow_visible">\n          <img src="/assets/images/icons/angle-icon.svg" alt="icon">\n        </button>\n      </div>\n    '),s=t.querySelector(".ribbon__inner");return this.categories.forEach((t=>{s.append(e(`\n          <a href="#" class="ribbon__item" data-id="${t.id}">${t.name}</a>\n        `))})),t}#n(){const e=this._elem.querySelector(".ribbon__inner"),t=this._elem.querySelector(".ribbon__arrow_left"),s=this._elem.querySelector(".ribbon__arrow_right");this._elem.addEventListener("click",(t=>{t.target.closest(".ribbon__arrow_right")?e.scrollBy(350,0):t.target.closest(".ribbon__arrow_left")&&e.scrollBy(-350,0)})),e.addEventListener("scroll",(()=>{const n=e.scrollWidth,i=e.scrollLeft,r=n-i-e.clientWidth;t.classList.toggle("ribbon__arrow_visible",0!==i),s.classList.toggle("ribbon__arrow_visible",r>1)})),e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.closest(".ribbon__item");t&&(this._elem.querySelectorAll(".ribbon__item").forEach((e=>e.classList.remove("ribbon__item_active"))),t.classList.add("ribbon__item_active"))})),this._elem.addEventListener("click",(e=>{const t=e.target.closest(".ribbon__item_active");t&&this._elem.dispatchEvent(new CustomEvent("ribbon-select",{detail:t.dataset.id,bubbles:!0}))}))}}const i=[{id:"",name:"All"},{id:"salads",name:"Salads"},{id:"soups",name:"Soups"},{id:"chicken-dishes",name:"Chicken dishes"},{id:"beef-dishes",name:"Beef dishes"},{id:"seafood-dishes",name:"Seafood dishes"},{id:"vegetable-dishes",name:"Vegetable dishes"},{id:"bits-and-bites",name:"Bits and bites"},{id:"on-the-side",name:"On the side"}];class r{constructor({steps:e,value:t=0}){this.steps=e,this.value=t,this._elem=this.#e(),this.changeValue(),this.dragSlider()}get elem(){return this._elem}#e(){const e=document.body,t=document.createElement("div");t.className="slider";const s=document.createElement("div");s.className="slider__thumb";const n=document.createElement("span");n.className="slider__value",n.textContent="0",s.appendChild(n);const i=document.createElement("div");i.className="slider__progress";const r=document.createElement("div");r.className="slider__steps";for(let e=0;e<this.steps;e++){const t=document.createElement("span");0===e&&(t.className="slider__step-active"),t.dataset.stepValue=e,r.appendChild(t)}return t.appendChild(s),t.appendChild(i),t.appendChild(r),e.appendChild(t),t}changeValue(){this._elem.addEventListener("click",(e=>{if(e.target.closest(".slider__thumb"))return;const t=this._elem.querySelector(".slider__steps");if(!t)return;const s=Array.from(t.children);if(!s.length)return;const n=t.getBoundingClientRect(),i=(e.clientX-n.left)/n.width,r=s[Math.round(i*(s.length-1))];this.updateValueFromStep(r)}))}dragSlider(){const e=this._elem.querySelector(".slider__thumb");e.ondragstart=()=>!1,e.addEventListener("pointerdown",(t=>{t.preventDefault();const s=this._elem,n=s.getBoundingClientRect(),i=s.querySelectorAll(".slider__steps span");s.classList.add("slider_dragging");const r=t=>{let i=(t-n.left)/n.width;i<0&&(i=0),i>1&&(i=1),e.style.left=100*i+"%",s.querySelector(".slider__progress").style.width=100*i+"%";const r=i*(this.steps-1);e.querySelector(".slider__value").textContent=Math.round(r)},o=e=>{r(e.clientX)},c=t=>{document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",c),s.classList.remove("slider_dragging");const r=(t.clientX-n.left)/n.width,a=this.steps-1;this.value=Math.round(r*a);const d=this.value/a*100;e.style.left=`${d}%`,s.querySelector(".slider__progress").style.width=`${d}%`,e.querySelector(".slider__value").textContent=this.value,i.forEach(((e,t)=>{e.classList.toggle("slider__step-active",t===this.value)})),this._elem.dispatchEvent(new CustomEvent("slider-change",{detail:this.value,bubbles:!0}))};document.addEventListener("pointermove",o),document.addEventListener("pointerup",c,{once:!0})}))}updateValueFromStep(e){const t=parseInt(e.dataset.stepValue);if(isNaN(t))return;const s=this._elem.querySelector(".slider__step-active");s&&s.classList.remove("slider__step-active"),e.classList.add("slider__step-active"),this.value=t;let n=this._elem.querySelector(".slider__progress");const i=this._elem.querySelector(".slider__thumb");i.querySelector(".slider__value").textContent=t;const r=t/(this.steps-1)*100;i.style.left=`${r}%`,n.style.width=`${r}%`,this._elem.dispatchEvent(new CustomEvent("slider-change",{detail:this.value,bubbles:!0}))}}class o{constructor(t){this._product=t,this._elem=e(`<div id="holder" class="container_half">\n      <div class="card">\n        <div class="card__top">\n          <img src="/assets/images/products/${this._product.image}" class="card__image" alt="product">\n          <span class="card__price">€${Number(this._product.price).toFixed(2)}</span>\n        </div>\n        <div class="card__body">\n          <div class="card__title">${this._product.name}</div>\n          <button type="button" class="card__button">\n            <img src="/assets/images/icons/plus-icon.svg" alt="icon">\n          </button>\n        </div>\n      </div>\n    </div>\n    `);const s=this._elem.querySelector(".card__button");s.addEventListener("click",(()=>{let e=new CustomEvent("product-add",{detail:this._product.id,bubbles:!0});s.dispatchEvent(e)}))}get elem(){return this._elem}}class c{constructor(e){this.products=e,this.filters={},this.render()}render(){this.elem=e('\n      <div class="products-grid">\n        <div class="products-grid__inner"></div>\n      </div>\n    '),this.updateFilter(this.filters)}updateFilter(e){Object.assign(this.filters,e);const t=this.elem.querySelector(".products-grid__inner");t.innerHTML="";for(const e of this.products){if(this.filters.category&&e.category!==this.filters.category)continue;if(void 0!==this.filters.maxSpiciness&&e.spiciness>this.filters.maxSpiciness)continue;if(this.filters.noNuts&&!0===e.nuts)continue;if(this.filters.vegeterianOnly&&!e.vegeterian)continue;const s=new o(e);t.append(s.elem)}}}class a{constructor(){this.render(),this.addEventListeners(),this.initialTopCoord=null}render(){this.elem=e('<div class="cart-icon"></div>')}update(e){e.isEmpty()?this.elem.classList.remove("cart-icon_visible"):(this.elem.classList.add("cart-icon_visible"),this.elem.innerHTML=`\n        <div class="cart-icon__inner">\n          <span class="cart-icon__count">${e.getTotalCount()}</span>\n          <span class="cart-icon__price">€${e.getTotalPrice().toFixed(2)}</span>\n        </div>`,this.updatePosition(),this.elem.classList.add("shake"),this.elem.addEventListener("transitionend",(()=>{this.elem.classList.remove("shake")}),{once:!0}))}addEventListeners(){document.addEventListener("scroll",(()=>this.updatePosition())),window.addEventListener("resize",(()=>this.updatePosition()))}updatePosition(){if(document.documentElement.clientWidth<=767)Object.assign(this.elem.style,{position:"",top:"",left:"",zIndex:""});else if(null===this.initialTopCoord&&(this.initialTopCoord=this.elem.getBoundingClientRect().top+window.pageYOffset),window.pageYOffset>this.initialTopCoord){const e=Math.min(document.querySelector(".container").getBoundingClientRect().right+20,document.documentElement.clientWidth-this.elem.offsetWidth-10)+"px";Object.assign(this.elem.style,{position:"fixed",top:"50px",left:e,zIndex:1e3})}else Object.assign(this.elem.style,{position:"",top:"",left:"",zIndex:""})}}class d{constructor(e,t){this.elem=this.#i(),this.open(),this.setTitle(e),this.setBody(t),this.setupEventListeners()}#i(){return e('\n      <div class="modal">\n        <div class="modal__overlay"></div>\n        <div class="modal__inner">\n          <div class="modal__header">\n            <button type="button" class="modal__close">\n              <img src="/assets/images/icons/cross-icon.svg" alt="close-icon" />\n            </button>\n            <h3 class="modal__title"></h3>\n          </div>\n          <div class="modal__body"></div>\n        </div>\n      </div>\n    ')}open(){document.body.classList.add("is-modal-open"),document.body.insertAdjacentElement("afterbegin",this.elem)}setTitle(e){this.elem.querySelector(".modal__title").textContent=e}setBody(e){let t=this.elem.querySelector(".modal__body");t.innerHTML="",t.append(e)}close(){document.body.classList.remove("is-modal-open"),this.elem.remove(),document.removeEventListener("keydown",this.escHandler)}setupEventListeners(){this.elem.querySelector(".modal__close").addEventListener("click",(()=>{this.close()})),this.escHandler=e=>{"Escape"===e.code&&this.close()},document.addEventListener("keydown",this.escHandler)}}class l{cartItems=[];constructor(e){this.cartIcon=e,this.addEventListeners()}addProduct(e){if(!e)return;let t=this.cartItems.find((t=>t.product.id===e.id));t?t.count+=1:(t={product:e,count:1},this.cartItems.push(t)),this.onProductUpdate(t)}updateProductCount(e,t){let s=this.cartItems.find((t=>t.product.id===e));s&&(1===t?s.count+=1:-1===t?s.count-=1:s.count,0===s.count&&this.cartItems.splice(this.cartItems.indexOf(s),1),this.onProductUpdate(s))}isEmpty(){return!this.cartItems.length}getTotalCount(){return this.cartItems.reduce(((e,t)=>e+t.count),0)}getTotalPrice(){return this.cartItems.reduce(((e,t)=>e+t.count*t.product.price),0)}renderProduct(t,s){return e(`\n    <div class="cart-product" data-product-id="${t.id}">\n      <div class="cart-product__img">\n        <img src="/assets/images/products/${t.image}" alt="product">\n      </div>\n      <div class="cart-product__info">\n        <div class="cart-product__title">${n=t.name,Array.from(n).map((e=>{switch(e){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return e}})).join("")}</div>\n        <div class="cart-product__price-wrap">\n          <div class="cart-counter">\n            <button type="button" class="cart-counter__button cart-counter__button_minus">\n              <img src="/assets/images/icons/square-minus-icon.svg" alt="minus">\n            </button>\n            <span class="cart-counter__count">${s}</span>\n            <button type="button" class="cart-counter__button cart-counter__button_plus">\n              <img src="/assets/images/icons/square-plus-icon.svg" alt="plus">\n            </button>\n          </div>\n          <div class="cart-product__price">€${t.price.toFixed(2)}</div>\n        </div>\n      </div>\n    </div>`);var n}renderOrderForm(){return e(`<form class="cart-form">\n      <h5 class="cart-form__title">Delivery</h5>\n      <div class="cart-form__group cart-form__group_row">\n        <input name="name" type="text" class="cart-form__input" placeholder="Name" required value="Santa Claus">\n        <input name="email" type="email" class="cart-form__input" placeholder="Email" required value="john@gmail.com">\n        <input name="tel" type="tel" class="cart-form__input" placeholder="Phone" required value="+1234567">\n      </div>\n      <div class="cart-form__group">\n        <input name="address" type="text" class="cart-form__input" placeholder="Address" required value="North, Lapland, Snow Home">\n      </div>\n      <div class="cart-buttons">\n        <div class="cart-buttons__buttons btn-group">\n          <div class="cart-buttons__info">\n            <span class="cart-buttons__info-text">total</span>\n            <span class="cart-buttons__info-price">€${this.getTotalPrice().toFixed(2)}</span>\n          </div>\n          <button type="submit" class="cart-buttons__button btn-group__button button">order</button>\n        </div>\n      </div>\n    </form>`)}renderModal(){const e=document.createElement("div");this.cartItems.forEach((({product:t,count:s})=>{const n=this.renderProduct(t,s);e.append(n)}));const t=this.renderOrderForm();e.append(t),this.modal=new d("Your order",e),t.addEventListener("submit",(e=>{e.preventDefault(),this.onSubmit(e)})),e.addEventListener("click",(e=>{const t=e.target,s=t.closest(".cart-product");if(!s)return;const n=s.dataset.productId;t.closest(".cart-counter__button_plus")?this.updateProductCount(n,1):t.closest(".cart-counter__button_minus")&&this.updateProductCount(n,-1)}))}onProductUpdate(e){if(this.cartIcon.update(this),document.body.classList.contains("is-modal-open")){const t=e.product.id,s=document.querySelector(".modal");if(!s)return;if(this.isEmpty())return void this.modal.close();const n=s.querySelector(`[data-product-id="${t}"] .cart-counter__count`),i=s.querySelector(`[data-product-id="${t}"] .cart-product__price`),r=s.querySelector(".cart-buttons__info-price");n&&(n.textContent=e.count),i&&(i.textContent=`€${(e.product.price*e.count).toFixed(2)}`),r&&(r.textContent=`€${this.getTotalPrice().toFixed(2)}`)}}onSubmit(e){e.preventDefault();const t=e.target;t.querySelector('button[type="submit"]').classList.add("is-loading");const s=new FormData(t);fetch("https://httpbin.org/post",{method:"POST",body:s}).then((e=>{e.ok&&(this.modal.setTitle("Success!"),this.cartItems=[],this.cartIcon.update(this),this.modal.elem.querySelector(".modal__body").innerHTML='\n            <div class="modal__body-inner">\n              <p>\n                Order successful! Your order is being cooked :) <br>\n                We\'ll notify you about delivery time shortly.<br>\n                <img src="/assets/images/delivery.gif">\n              </p>\n            </div>\n  ')})).catch((e=>console.log(e)))}addEventListeners(){this.cartIcon.elem.onclick=()=>this.renderModal()}}(new class{constructor(){}async render(){this.cart=null,this.cartIcon=null,this.productsGrid=null,this.stepSlider=null,this.ribbonMenu=null;const e=document.querySelector("[data-carousel-holder]"),o=new t(s);e.innerHTML="",e.append(o.elem);const c=document.querySelector("[data-ribbon-holder]");this.ribbonMenu=new n(i),c.innerHTML="",c.append(this.ribbonMenu.elem);const d=document.querySelector("[data-slider-holder]");this.stepSlider=new r({steps:5,value:3}),d.innerHTML="",d.append(this.stepSlider.elem);const u=document.querySelector("[data-cart-icon-holder]");this.cartIcon=new a,u.append(this.cartIcon.elem),this.cart=new l(this.cartIcon),await this.productsGridRender(),this.productsGrid.updateFilter({noNuts:document.getElementById("nuts-checkbox").checked,vegeterianOnly:document.getElementById("vegeterian-checkbox").checked,maxSpiciness:this.stepSlider.value,category:this.ribbonMenu.value}),this.setupEventListeners()}async productsGridRender(){const e=await fetch("products.json"),t=await e.json(),s=document.querySelector("[data-products-grid-holder]");s.innerHTML="",this.productsGrid=new c(t),s.append(this.productsGrid.elem)}setupEventListeners(){document.body.addEventListener("product-add",(e=>{const t=e.detail,s=this.productsGrid.products.find((e=>e.id===t));this.cart.addProduct(s)})),this.stepSlider.elem.addEventListener("slider-change",(e=>{this.productsGrid.updateFilter({maxSpiciness:e.detail})})),this.ribbonMenu.elem.addEventListener("ribbon-select",(e=>{this.productsGrid.updateFilter({category:e.detail})})),document.getElementById("nuts-checkbox").addEventListener("change",(e=>{this.productsGrid.updateFilter({noNuts:e.target.checked})})),document.getElementById("vegeterian-checkbox").addEventListener("change",(e=>{this.productsGrid.updateFilter({vegeterianOnly:e.target.checked})}))}}).render().then((()=>console.log("App started!")))})();